(function($){var popups_displayed=[];function gamipress_congratulations_popups_show_next_popup(){var overlay=$('.gamipress-congratulations-popups-overlay');if(!overlay.length){$('body').append('<div class="gamipress-congratulations-popups-overlay" style="display: none;"></div>');overlay=$('.gamipress-congratulations-popups-overlay')}
setTimeout(function(){if(!overlay.hasClass('active')){overlay.addClass('active');overlay.fadeIn(500)}
var popup=$('.gamipress-congratulations-popup-wrapper').first();var popup_id=popup.attr('id');if(popups_displayed.indexOf(popup_id)!==-1){popup.remove();if($('.gamipress-congratulations-popup-wrapper').length){gamipress_congratulations_popups_show_next_popup()}else{overlay.fadeOut(500);overlay.removeClass('active')}
return}
popup.addClass('active');var show_sound=popup.data('show-sound');if(show_sound.length){gamipress_congratulations_popups_play_sound(show_sound)}
popup.fadeIn(500,function(){gamipress_congratulations_popups_show_effect(popup)})},300)}
function gamipress_congratulations_popups_hide_current_popup(){var current_popup=$('.gamipress-congratulations-popup-wrapper.active');var overlay=$('.gamipress-congratulations-popups-overlay');var congratulations_popup_display_id=current_popup.attr('id').replace('gamipress-congratulations-popup-display-','');var hide_sound=current_popup.data('hide-sound');if(hide_sound.length){gamipress_congratulations_popups_play_sound(hide_sound)}
current_popup.fadeOut(500,function(){popups_displayed.push(current_popup.attr('id'));$(this).remove();if($('.gamipress-congratulations-popup-wrapper').length){setTimeout(function(){gamipress_congratulations_popups_show_next_popup()},500)}else{overlay.fadeOut(500);overlay.removeClass('active')}});$.ajax({url:gamipress_congratulations_popups.ajaxurl,data:{action:'gamipress_congratulations_popups_popup_shown',nonce:gamipress_congratulations_popups.nonce,congratulations_popup_display_id:congratulations_popup_display_id},success:function(response){console.log(response)}})}
function gamipress_congratulations_popups_play_sound(src){var filename=src.split(/[\\\/]/).pop();if(filename===undefined)return;var src_parts=src.match(/\.([^.]+)$/);if(src_parts===null)return;var ext=src_parts[1];var id=filename.replace('.','_');var audio=document.getElementById(id);if(audio){gamipress_congratulations_popups_play_player(audio);return}
var source=document.createElement('source');source.src=src;source.type='audio/'+ext;audio=document.createElement('audio');audio.id=id;audio.appendChild(source);document.body.appendChild(audio);gamipress_congratulations_popups_play_player(audio)}
function gamipress_congratulations_popups_play_player(audio){audio.currentTime=0;audio.volume=1;audio.load();setTimeout(function(){audio.play().catch(()=>{audio.play().catch(()=>{})})},0)}
var congratulations_popups_request;function gamipress_congratulations_popups_check_popups(){if(congratulations_popups_request!==undefined){return}
var show_user_points=$('.gamipress-user-points').length;congratulations_popups_request=$.ajax({url:gamipress_congratulations_popups.ajaxurl,data:{action:'gamipress_congratulations_popups_get_popups',nonce:gamipress_congratulations_popups.nonce,user_points:show_user_points},success:function(response){var i;if(response.data.popups!==undefined&&response.data.popups.length){for(i=0;i<response.data.popups.length;i++){var content=response.data.popups[i];$('body').append(content)}
gamipress_congratulations_popups_show_next_popup()}
if(show_user_points&&response.data.user_points.length){for(i=0;i<response.data.user_points.length;i++){var user_points=response.data.user_points[i];$('.gamipress-user-points.gamipress-is-current-user .gamipress-user-points-'+user_points.points_type+' .gamipress-user-points-count').text(user_points.points)}}
congratulations_popups_request=undefined}})}
gamipress_congratulations_popups_check_popups();function gamipress_congratulations_popups_is_url_excluded(url,data){if(url===undefined){url=''}
if(data===undefined){data=url}
var excluded_url=!1;gamipress_congratulations_popups.excluded_urls.forEach(function(to_match){if(url.includes(to_match)){excluded_url=!0}});if(excluded_url){return!0}
var excluded_data=!1;gamipress_congratulations_popups.excluded_data.forEach(function(to_match){if(data.includes(to_match)){excluded_data=!0}});if(excluded_data){return!0}
if(url.includes('admin-ajax.php')){var excluded_action=!1;gamipress_congratulations_popups.excluded_ajax_actions.forEach(function(to_match){if(data.includes('action='+to_match)){excluded_action=!0}});if(excluded_action){return!0}}
return!1}
$(document).ajaxSuccess(function(event,request,settings){if(gamipress_congratulations_popups_is_url_excluded(settings.url,settings.data)){return}
var status=parseInt(request.status);if(status===200){setTimeout(gamipress_congratulations_popups_check_popups,parseInt(gamipress_congratulations_popups.ajax_check_delay))}});$('body').on('click','.gamipress-congratulations-popup-close',function(){gamipress_congratulations_popups_hide_current_popup()})})(jQuery)